<!DOCTYPE html>
<meta charset="utf-8">
<style>

body {
  font: 10px sans-serif;
}

.chord {
  fill-opacity: .67;
}

</style>
<body>
    <link type="text/css" rel="stylesheet" href="css/semantic.min.css"/>
    <link type="text/css" rel="stylesheet" href="css/style2.css"/>
	<script type="text/javascript" src="js/jquery-1.11.3.min.js"></script>
	<script type="text/javascript" src="js/semantic.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js"></script>
    <script type="text/javascript" src="js/maia.js"></script>
    <script type="text/javascript" src="js/socket.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js"></script>

<div class="ui top secondary pointing menu">
		<p class="header item">MAIA</p>
		<div class="ui dropdown item">
			<i class="laptop icon"></i>
			http://localhost:9091/
			<i class="dropdown icon"></i>
			<div class="menu">
			  <a class="item">
			<i class="desktop icon"></i>http://10.106.39.175:9091/</a>
			  <a class="item">
			<i class="tablet icon"></i>http://10.106.39.172:9091/</a>
			  <div class="divider"></div>
			  <a class="item">Connect...</a>
			</div>
		  </div>
		<a class="active red item" href="bundles.html">
			<i class="plug icon"></i>Bundles
		</a>
		<a class="item" href="threads.html"><i class="tasks icon"></i>Threads</a>
		<a class="item" href="contexts.html"><i class="grid layout icon"></i>Contexts</a>
		<a class="item"><i class="file text outline icon"></i>Logs</a>
		<a class="item"><i class="download icon"></i>Backups</a>
		 
		  <div class="right menu">
			 
			  <div class="link item">
				<div class="ui icon top right pointing dropdown">
				  <i class="wrench icon"></i>
				  <div class="menu">
					<div class="header">Display Density</div>
					<div class="item">Comfortable</div>
					<div class="item">Cozy</div>
					<div class="item">Compact</div>
					<div class="ui divider"></div>
					<div class="item">Settings</div>
					<div class="item">
					  <i class="dropdown icon"></i>
					  <span class="text">Upload Settings</span>
					  <div class="menu">
						<div class="item">
						  <i class="check icon"></i>
						  Convert Uploaded Files to PDF
						</div>
						<div class="item">
						  <i class="check icon"></i>
						  Digitize Text from Uploaded Files
						</div>
					  </div>
					</div>
					<div class="item">Manage Apps</div>
					<div class="item">Keyboard Shortcuts</div>
					<div class="item">Help</div>
				  </div>
				</div>
			  </div>
		  </div>
		
	</div>
	
<script>

var outerRadius = 1000 / 2,
    innerRadius = 250;

var fill = d3.scale.category20c();

var chord = d3.layout.chord()
    .padding(.01)
    .sortSubgroups(d3.descending)
    .sortChords(d3.descending);

var arc = d3.svg.arc()
    .innerRadius(innerRadius)
    .outerRadius(innerRadius + 60);

var svg = d3.select("body").append("svg")
    .attr("width", outerRadius * 4)
    .attr("height", outerRadius * 2)
  .append("g")
    .attr("transform", "translate(" + outerRadius + "," + outerRadius + ")");
 

function updateBundles(imports){
	imports.sort();
  var indexByName = d3.map(),
      nameByIndex = d3.map(),
      matrix = [],
      n = 0;

  // Returns the Flare package name for the given class name.
  function name(n) {
    return n;//name.substring(0, name.lastIndexOf(".")).substring(6);
  }

  // Compute a unique index for each package name.
  imports.forEach(function(d) {
    if (!indexByName.has(d = name(d.name))) {
      nameByIndex.set(n, d);
      indexByName.set(d, n++);
    }
  });

  // Construct a square matrix counting package imports.
  imports.forEach(function(d) {
    var source = indexByName.get(name(d.name)),
        row = matrix[source];
    if (!row) {
     row = matrix[source] = [];
     for (var i = -1; ++i < n;) row[i] = 0;
    }
    d.imports.forEach(function(d) { row[indexByName.get(name(d))]++; });
  });

  chord.matrix(matrix);
  
  function showImports(d){
	g.filter(function(l) { return l != d; })
		.style("opacity", 0.1);
	var n = [];
	
	links.filter(function(l) {
		var result = l.source.index != d.index;
		if (!result){
			n.push(l.target.index);
		}
		return result; 
		}).style("opacity", 0.01);
	//console.log(n);
	if (n.length > 0){
		g.filter(function(l) { return n.indexOf(l.index) > -1; })
			.style("opacity", 0.8);
	}
  }
  
  
  function showExports(d){
	g.filter(function(l) { return l != d; })
		.style("opacity", 0.1);
	var n = [];
	
	links.filter(function(l) {
		var result = l.target.index != d.index;
		if (!result){
			n.push(l.source.index);
		}
		return result; 
		}).style("opacity", 0.01);
	//console.log(n);
	if (n.length > 0){
		g.filter(function(l) { return n.indexOf(l.index) > -1; })
			.style("opacity", 0.8);
	}
  }
  
  function showImportExports(d){
	g.filter(function(l) { return l != d; })
		.style("opacity", 0.1);
	var n = [];
	
	links.filter(function(l) {
		var result1 = l.target.index != d.index;
		if (!result1){
			n.push(l.source.index);
		}
		var result2 = l.source.index != d.index;
		if (!result2){
			n.push(l.target.index);
		}
		return result1 & result2; 
	}).style("opacity", 0.01);
	//console.log(n);
	if (n.length > 0){
		g.filter(function(l) { return n.indexOf(l.index) > -1; })
			.style("opacity", 0.8);
	}
  }
  
  $(document)
	.on("mousedown", "svg", function(e) {
		e.stopPropagation();
		e.stopImmediatePropagation();
		e.preventDefault();
		return false;})
	.on("contextmenu", "svg", function(e) {
		e.stopPropagation();
		e.stopImmediatePropagation();
		e.preventDefault();
		return false;})
	;

	//var mouseDownCount = 0;
	
  var g = svg.selectAll(".bundle")
      .data(chord.groups)
    .enter().append("g")
      .attr("class", "bundle")
	  .on("mousedown", function(d){
		switch (d3.event.buttons){
			case 1 :
				showImports(d);
				break;
			case 2 :
				showExports(d);
				break;
			case 3 :
			case 4 :
				showImportExports(d);
				break;
			default :
				break;
		}
	  })
	  .on("mouseup", function(d){
		g.style("opacity", 1);
		links.style("opacity", 1);
	  });
	
	var h = {};
	
  var nodes = g.append("path")
      .style("fill", function(d) { return fill(2); })
      .style("stroke", function(d) { return fill(2); })
      .attr("d", arc);

  g.append("text")
      .each(function(d) { d.angle = (d.startAngle + d.endAngle) / 2; })
      .attr("dy", ".35em")
	  //.style("opacity", 1)
	  .style("font-size", 10)
      .attr("transform", function(d) {
        return "rotate(" + (d.angle * 180 / Math.PI - 90) + ")"
            + "translate(" + (innerRadius + 65) + ")"
            + (d.angle > Math.PI ? "rotate(180)" : "");
      })
      .style("text-anchor", function(d) { return d.angle > Math.PI ? "end" : null; })
      .text(function(d) { return nameByIndex.get(d.index); });

  var links = svg.selectAll(".chord")
      .data(chord.chords)
    .enter().append("path")
      .attr("class", "chord")
      .style("stroke", function(d) { return fill(2); })
      .style("fill", function(d) { return fill(2); })
      .attr("d", d3.svg.chord().radius(innerRadius));
}

d3.select(self.frameElement).style("height", outerRadius * 2 + "px");

</script>
</body>